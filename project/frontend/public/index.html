<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Search and Management</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.24.6/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [screen, setScreen] = useState('search');
      const [products, setProducts] = useState([]);
      const [searchQuery, setSearchQuery] = useState('');
      const [categoryFilter, setCategoryFilter] = useState('');
      const [priceRange, setPriceRange] = useState([0, 1000]);
      const [categories, setCategories] = useState([]);
      const [formData, setFormData] = useState({
        name: '', category: '', price: '', description: '', quantity: ''
      });
      const [formError, setFormError] = useState('');

      // Fetch products from API
      const fetchProducts = async () => {
        try {
          const response = await axios.get('/api/products', {
            params: { q: searchQuery, category: categoryFilter, minPrice: priceRange[0], maxPrice: priceRange[1] }
          });
          setProducts(response.data);
          // Extract unique categories
          const uniqueCategories = [...new Set(response.data.map(p => p.category).filter(c => c))];
          setCategories(uniqueCategories);
        } catch (error) {
          console.error('Error fetching products:', error);
        }
      };

      useEffect(() => {
        fetchProducts();
      }, [searchQuery, categoryFilter, priceRange]);

      // Handle form input changes
      const handleFormChange = (e) => {
        setFormData({ ...formData, [e.target.name]: e.target.value });
      };

      // Handle form submission
      const handleFormSubmit = async (e) => {
        e.preventDefault();
        // Basic validation
        if (!formData.name || !formData.price || !formData.quantity) {
          setFormError('Name, price, and quantity are required.');
          return;
        }
        if (isNaN(formData.price) || isNaN(formData.quantity) || formData.price < 0 || formData.quantity < 0) {
          setFormError('Price and quantity must be valid non-negative numbers.');
          return;
        }
        try {
          await axios.post('/api/products', formData);
          setFormData({ name: '', category: '', price: '', description: '', quantity: '' });
          setFormError('');
          setScreen('search');
          fetchProducts(); // Refresh product list
          alert('Product added successfully!');
        } catch (error) {
          setFormError('Error adding product. Please try again.');
          console.error('Error adding product:', error);
        }
      };

      return (
        <div className="container mx-auto p-4">
          {/* Navigation */}
          <nav className="flex justify-between items-center mb-6 bg-white p-4 shadow-md rounded-lg">
            <h1 className="text-2xl font-bold text-gray-800">Product Management</h1>
            <div>
              <button
                onClick={() => setScreen('search')}
                className={`px-4 py-2 mr-2 rounded-lg ${screen === 'search' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
              >
                Search Products
              </button>
              <button
                onClick={() => setScreen('add')}
                className={`px-4 py-2 rounded-lg ${screen === 'add' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
              >
                Add Product
              </button>
            </div>
          </nav>

          {/* Search Screen */}
          {screen === 'search' && (
            <div>
              {/* Search Bar and Filters */}
              <div className="bg-white p-6 shadow-md rounded-lg mb-6">
                <input
                  type="text"
                  placeholder="Search products..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <div className="flex flex-wrap gap-4">
                  {/* Category Filter */}
                  <div className="flex-1 min-w-[200px]">
                    <label className="block text-gray-700 mb-1">Category</label>
                    <select
                      value={categoryFilter}
                      onChange={(e) => setCategoryFilter(e.target.value)}
                      className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">All Categories</option>
                      {categories.map((cat) => (
                        <option key={cat} value={cat}>{cat}</option>
                      ))}
                    </select>
                  </div>
                  {/* Price Range Filter */}
                  <div className="flex-1 min-w-[200px]">
                    <label className="block text-gray-700 mb-1">Price Range</label>
                    <div className="flex gap-2">
                      <input
                        type="number"
                        placeholder="Min"
                        value={priceRange[0]}
                        onChange={(e) => setPriceRange([+e.target.value, priceRange[1]])}
                        className="w-1/2 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      <input
                        type="number"
                        placeholder="Max"
                        value={priceRange[1]}
                        onChange={(e) => setPriceRange([priceRange[0], +e.target.value])}
                        className="w-1/2 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                    </div>
                  </div>
                </div>
              </div>
              {/* Product List */}
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {products.length > 0 ? (
                  products.map((product) => (
                    <div key={product.id} className="bg-white p-4 shadow-md rounded-lg">
                      <h2 className="text-lg font-semibold text-gray-800">{product.name}</h2>
                      <p className="text-gray-600">Category: {product.category || 'N/A'}</p>
                      <p className="text-gray-600">Price: ${product.price.toFixed(2)}</p>
                      <p className="text-gray-600">Quantity: {product.quantity}</p>
                      <p className="text-gray-500 mt-2">{product.description || 'No description'}</p>
                    </div>
                  ))
                ) : (
                  <p className="text-gray-600">No products found.</p>
                )}
              </div>
            </div>
          )}

          {/* Add Product Screen */}
          {screen === 'add' && (
            <div className="bg-white p-6 shadow-md rounded-lg">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">Add New Product</h2>
              {formError && <p className="text-red-500 mb-4">{formError}</p>}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-gray-700 mb-1">Name *</label>
                  <input
                    type="text"
                    name="name"
                    value={formData.name}
                    onChange={handleFormChange}
                    className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required
                  />
                </div>
                <div>
                  <label className="block text-gray-700 mb-1">Category</label>
                  <input
                    type="text"
                    name="category"
                    value={formData.category}
                    onChange={handleFormChange}
                    className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div>
                  <label className="block text-gray-700 mb-1">Price *</label>
                  <input
                    type="number"
                    name="price"
                    value={formData.price}
                    onChange={handleFormChange}
                    className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    min="0"
                    step="0.01"
                    required
                  />
                </div>
                <div>
                  <label className="block text-gray-700 mb-1">Quantity *</label>
                  <input
                    type="number"
                    name="quantity"
                    value={formData.quantity}
                    onChange={handleFormChange}
                    className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    min="0"
                    required
                  />
                </div>
                <div className="md:col-span-2">
                  <label className="block text-gray-700 mb-1">Description</label>
                  <textarea
                    name="description"
                    value={formData.description}
                    onChange={handleFormChange}
                    className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows="4"
                  ></textarea>
                </div>
              </div>
              <button
                onClick={handleFormSubmit}
                className="mt-4 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
              >
                Add Product
              </button>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
